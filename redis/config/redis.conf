# Redis 설정 파일 - Refresh Token 저장소용
# 기본 포트
port 6379

# 바인드 주소 (모든 인터페이스에서 접근 허용)
bind 0.0.0.0

# 비밀번호 설정 (보안 강화)
# requirepass pirate123!

# 최대 메모리 설정 (Refresh Token용으로 적당한 크기)
maxmemory 128mb
maxmemory-policy allkeys-lru

# 데이터베이스 수
databases 16

# =============================================================================
# RDB 설정 (Refresh Token용 - 보수적 설정)
# =============================================================================
# Refresh Token은 중요한 인증 정보이므로 자주 저장
# 60초마다 1개 이상 키 변경시 저장 (매우 빈번)
save 60 1
# 300초마다 10개 이상 키 변경시 저장 (빈번)
save 300 10
# 900초마다 100개 이상 키 변경시 저장 (일반적)
save 900 100

# RDB 파일 압축 사용 (디스크 공간 절약)
rdbcompression yes

# RDB 파일 체크섬 사용 (데이터 무결성)
rdbchecksum yes

# RDB 파일명
dbfilename dump.rdb

# =============================================================================
# AOF 설정 (Refresh Token용 - 데이터 안전성 최우선)
# =============================================================================
# AOF 활성화 (Refresh Token 손실 방지를 위해 필수)
appendonly yes

# AOF 파일명
appendfilename "appendonly.aof"

# AOF 동기화 정책 - 매초마다 디스크에 쓰기 (성능과 안전성의 균형)
# always: 매 명령마다 동기화
# everysec: 매초마다 동기화
# no: OS가 결정
appendfsync everysec

# AOF 재작성 시 fsync 비활성화 (재작성 성능 향상)
no-appendfsync-on-rewrite no

# AOF 자동 재작성 설정
# 파일 크기가 64MB 이상이고, 이전 크기의 100% 증가시 재작성
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# AOF 로드 시 손상된 부분 무시 (부분 복구 허용)
aof-load-truncated yes

# =============================================================================
# 기타 설정
# =============================================================================
# 로그 레벨
loglevel notice

# TCP keepalive (연결 유지)
tcp-keepalive 300

# 클라이언트 타임아웃 (0 = 비활성화, Refresh Token은 장시간 유지되므로)
timeout 0

# 백그라운드 저장 실패 시 쓰기 중단 (데이터 안전성)
stop-writes-on-bgsave-error yes

# 키 만료 정책 최적화 (Refresh Token TTL 처리)
# 매 사이클마다 만료된 키 검사 비율
hz 10

# 메모리 사용량 샘플링 크기
maxmemory-samples 5